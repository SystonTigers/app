<!DOCTYPE html>
<html>
<head>
  <title><?= title ? `${title} ‚Äì ${config.TEAM_NAME}` : config.TEAM_NAME ?></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: <?= config.PRIMARY_COLOR ?>;
      --secondary: <?= config.SECONDARY_COLOR ?>;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #f8f9fa; padding: 20px; min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    .header {
      background: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;
    }
    .content {
      display: grid; grid-template-columns: 1fr 2fr; gap: 30px;
    }
    .form-section, .list-section {
      background: white; padding: 25px; border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block; margin-bottom: 5px; font-weight: 600; color: #333;
    }
    input, select, textarea {
      width: 100%; padding: 12px; border: 2px solid #e1e5e9;
      border-radius: 8px; font-size: 16px; transition: border-color 0.3s;
    }
    input:focus, select:focus, textarea:focus {
      outline: none; border-color: var(--primary);
    }
    .btn {
      background: #28a745; color: white; padding: 12px 25px;
      border: none; border-radius: 8px; font-size: 16px; font-weight: 600;
      cursor: pointer; transition: background 0.3s; width: 100%;
    }
    .btn:hover { background: #218838; }
    .player-list {
      max-height: 500px; overflow-y: auto;
    }
    .player-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 15px; border-bottom: 1px solid #eee;
    }
    .player-info h4 { margin: 0; color: #333; }
    .player-info p { margin: 5px 0 0 0; color: #666; font-size: 14px; }
    .back-btn {
      background: #6c757d; margin-bottom: 20px; width: auto; display: inline-block;
      text-decoration: none; text-align: center;
    }
    .club-badge {
      width: 60px; height: 60px; margin: 0 auto 15px;
      background: url('<?= config.BADGE_URL ?>') center/contain no-repeat;
      border-radius: 50%;
    }
    @media (max-width: 768px) {
      .content { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="?" class="btn back-btn">‚Üê Back to Dashboard</a>
      <? if (config.BADGE_URL && !config.BADGE_URL.includes('[SET')) { ?>
        <div class="club-badge"></div>
      <? } ?>
      <h1>üë• <?= config.TEAM_NAME ?> - Player Management</h1>
      <p>Add and manage your squad - names, DOB, positions, everything!</p>
    </div>

    <div class="content">
      <div class="form-section">
        <h2>Add New Player</h2>
        <form id="playerForm">
          <div class="form-group">
            <label for="playerName">Full Name *</label>
            <input type="text" id="playerName" name="playerName" required
                   placeholder="e.g. John Smith">
          </div>

          <div class="form-group">
            <label for="playerDOB">Date of Birth * (DD/MM/YYYY)</label>
            <input type="date" id="playerDOB" name="playerDOB" required>
            <small style="color: #666;">Use UK date format: DD/MM/YYYY</small>
          </div>

          <div class="form-group">
            <label for="playerPosition">Position *</label>
            <select id="playerPosition" name="playerPosition" required>
              <option value="">Select Position</option>
              <option value="Goalkeeper">Goalkeeper</option>
              <option value="Defender">Defender</option>
              <option value="Midfielder">Midfielder</option>
              <option value="Forward">Forward</option>
              <option value="Utility">Utility</option>
            </select>
          </div>

          <div class="form-group">
            <label for="playerNumber">Squad Number</label>
            <input type="number" id="playerNumber" name="playerNumber" min="1" max="99"
                   placeholder="Optional">
          </div>

          <div class="form-group">
            <label for="playerEmail">Email</label>
            <input type="email" id="playerEmail" name="playerEmail"
                   placeholder="Optional - for communications">
          </div>

          <div class="form-group">
            <label for="playerPhone">Phone</label>
            <input type="tel" id="playerPhone" name="playerPhone"
                   placeholder="Optional - emergency contact">
          </div>

          <div class="form-group">
            <label for="playerNotes">Notes</label>
            <textarea id="playerNotes" name="playerNotes" rows="3"
                      placeholder="Any additional information..."></textarea>
          </div>

          <button type="submit" class="btn">‚ûï Add Player to <?= config.TEAM_SHORT ?></button>
        </form>
      </div>

      <div class="list-section">
        <h2><?= config.TEAM_SHORT ?> Current Squad</h2>
        <div class="player-list" id="playerList">
          <div class="player-item">
            <div class="player-info">
              <h4>Loading players...</h4>
              <p>Please wait while we load your squad</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('playerForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const formData = new FormData(e.target);
      formData.append('action', 'add_player');

      try {
        const response = await fetch(window.location.href.split('?')[0], {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (result.success) {
          alert('‚úÖ Player added successfully to <?= config.TEAM_NAME ?>!');
          e.target.reset();
          loadPlayers();
        } else {
          alert('‚ùå Error: ' + result.error);
        }
      } catch (error) {
        alert('‚ùå Error adding player: ' + error.message);
      }
    });

    function loadPlayers() {
      // Load actual players from Google Sheets
      google.script.run
        .withSuccessHandler(function(players) {
          const playerList = document.getElementById('playerList');

          if (players && players.length > 0) {
            playerList.innerHTML = players.map(player => `
              <div class="player-item">
                <div class="player-info">
                  <h4>${player.name}</h4>
                  <p>${player.position} ‚Ä¢ Age ${player.age}${player.number ? ' ‚Ä¢ #' + player.number : ''}</p>
                </div>
              </div>
            `).join('');
          } else {
            playerList.innerHTML = `
              <div class="player-item">
                <div class="player-info">
                  <h4>No players added yet</h4>
                  <p>Use the form to add your first player to <?= config.TEAM_NAME ?></p>
                </div>
              </div>
            `;
          }
        })
        .withFailureHandler(function(error) {
          console.error('Failed to load players:', error);
          const playerList = document.getElementById('playerList');
          playerList.innerHTML = `
            <div class="player-item">
              <div class="player-info">
                <h4>Error loading players</h4>
                <p>Please refresh the page to try again</p>
              </div>
            </div>
          `;
        })
        .getPlayersList();
    }

    loadPlayers();
    console.log('üë• <?= config.TEAM_NAME ?> Player Management Ready!');
  </script>
</body>
</html>