match:
  # default half length for this team; EDL can override per match
  default_half_minutes: 49
  added_time_fallback_minutes: 2
  # enable if EDL includes HT / 2H KO / FT markers to align clock
  trust_status_markers: true

paths:
  intro: assets/intro.mp4
  outro: assets/outro.mp4
  font: assets/Font-Bold.ttf
  home_badge: assets/home.png
  away_badge: assets/away.png

render:
  fps: 30
  crf: 20
  preset: veryfast
  audio_bitrate_k: 160
  loudnorm: true

variants:
  produce_169: true
  produce_11: true
  produce_916: true

padding:
  default: { pre: 7, post: 10 }
  goal:
    pre_bonus_on_attack: 5
    post_bonus_on_celebration: 8
  save:
    pre: 11
    post: 7
  chance:
    pre: 8
    post: 8
  foul_or_card:
    pre: 4
    post: 10
  max_pre: 15
  max_post: 25

replay:
  enable_for: ["goal","goal_like","big_save"]
  slowmo_factor: 0.5        # 50% speed
  freeze_ms: 300            # hold at impact
  pip: true                 # picture-in-picture of alternate crop
  stinger: true             # "REPLAY" stinger text

zoom:
  enable: true
  min_zoom: 1.08
  max_zoom: 1.30
  smoothing: 0.15           # EMA smoothing for bbox
  edge_margin_pct: 0.18     # padding around tracked box

detection:
  audio_peak_sigma: 3.0
  scene_cut_threshold: 30   # histogram diff, tune on samples
  goal_area_grid: 3         # thirds; count players in attacking third
  celebration_window_s: 6
  promote_if_signals: 2     # promote candidate if ≥2 signals overlap ±4s
  dedupe_window_s: 15       # merge with guided events if within this window
  scorebug_ocr: false       # keep false unless OCR is implemented

  # Phase 1: Multi-Signal Detection (NEW)
  multi_signal:
    enabled: true
    bucket_size: 1.0        # Time bucket size in seconds
    min_confidence: 0.3     # Minimum score to keep event

    # Signal weights for fusion
    weights:
      json: 5.0             # Ground truth (Apps Script)
      yolo: 2.0             # Visual object detection
      audio: 1.5            # Crowd reactions (energy spikes)
      whistle: 1.0          # Referee whistles
      flow: 1.0             # Optical flow bursts
      scene_cut: 0.5        # Production cuts
      commentary: 1.2       # ASR keywords (if enabled)

    # Audio detection settings
    audio:
      enabled: true
      threshold: 0.75       # Energy threshold (normalized)
      min_duration: 1.0     # Minimum spike duration (seconds)

    # Whistle detection settings
    whistle:
      enabled: true
      freq_range: [3500, 4500]  # Frequency range in Hz
      threshold: 0.7        # Detection confidence threshold

    # Optical flow settings
    flow:
      enabled: true
      roi: goal_area        # Region of interest: goal_area, center, full_frame
      threshold: 2.5        # Flow magnitude threshold
      sample_rate: 2        # Process every Nth frame (for speed)

    # Scene cut detection
    scene_cut:
      enabled: true
      threshold: 30.0       # Histogram difference threshold
      sample_rate: 1        # Process every Nth frame

    # ASR commentary detection (optional, requires Whisper)
    commentary:
      enabled: false        # Set to true if you have Whisper installed
      model: tiny           # Whisper model: tiny, base, small, medium, large
      keywords:
        - goal
        - save
        - penalty
        - foul
        - card
        - yellow
        - red
        - corner
        - shot
        - miss

limits:
  max_clips: 40
  min_clip_len_s: 6
  max_clip_len_s: 30