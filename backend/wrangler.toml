name = "syston-postbus"
main = "dist/index.js"
compatibility_date = "2025-09-30"
minify = true
workers_dev = true

[observability]
enabled = true

[vars]
API_VERSION = "v1"
JWT_ISSUER = "syston.app"
JWT_AUDIENCE = "syston-mobile"
# Fixtures refresh endpoint
FIXTURES_REFRESH_URL = "https://syston-fixtures.team-platform-2025.workers.dev/refresh"
# Allowlist of hosts for BYO-Make webhooks (comma-separated)
ALLOWED_WEBHOOK_HOSTS = "hook.make.com,webhook.site"
# Public URL for tenant setup page
SETUP_URL = "https://setup.yourbrand.app"
# YouTube OAuth redirect URL (update with your domain when ready)
YT_REDIRECT_URL = "https://syston-postbus.team-platform-2025.workers.dev/api/v1/admin/yt/callback"
# CORS allowed origins (comma-separated, optional - defaults include localhost)
# CORS_ALLOWED = "https://app.yourbrand.com,https://admin.yourbrand.com"

[[kv_namespaces]]
binding = "KV_IDEMP"
id = "5948d4a91ac04b50904a06c923221994"   # <-- replace after Step 3 (if regenerated)

# --- Queues
[[queues.producers]]
binding = "POST_QUEUE"
queue = "post-queue"

[[queues.producers]]
binding = "DLQ"
queue = "dead-letter"

[[queues.consumers]]
queue = "post-queue"

# --- Durable Object
[[durable_objects.bindings]]
name = "TenantRateLimiter"
class_name = "TenantRateLimiter"

# --- DO migration
[[migrations]]
tag = "v1"
new_classes = [ "TenantRateLimiter" ]

# Custom domain routes (update zone_name with your actual domain)
# routes = [
#   { pattern = "api.YOURBRAND.com/*", zone_name = "YOURBRAND.com" }
# ]


